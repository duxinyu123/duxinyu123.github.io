---
layout:     post                    # 使用的布局（不需要改）
title:      Python多任务编程    		# 标题 
subtitle:    						#副标题
date:       2021-01-06              # 时间
author:     新宇                     # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - Python
---

# 一、多任务
## 1. 多任务
在同一时间段，同时执行多个任务
## 2. 并发
任务数量 > CPU核心数量，CPU核心在**同一时间**段交替执行
## 3. 并行
任务数量 < CPU核心数量，**同一时刻**执行多个任务（指多核情况下）
# 二、进程
## 1.概念：
进程是操作系统**调度和分配资源**的最小单位

## 2.特点
- 程序开启后默认开启一个进程
- 开启多个进程执行任务效率更高
- 开启进程后默认开启一个主线程

## 3.实现多进程
任务调用单位：函数

```python
# 1. 导入进程包

import multiprocessing  

# 2. 通过进程类创建进程对象(func是函数名,可省略：name进程名,group进程组) 

def func():  
	print("music.....")  
p = multiprocessing.Process(target=func, name=proc_name, group=None)  

# 3. 启动进程  

p.start()  
```
## 4. 面向对象实现


```python
import multiprocessing 

class MyProcess(multiprocessing.Process):
    def __init__(self):
        super().__init__()

    def music(self):
        print('music...')

    def run(self) -> None:
    	self.music()

m = MyProcess()

m.start()

```

## 5. 进程传递参数

- 通过元组  multiprocessing.Process(target=func, args=(3,))  
- 通过dict  multiprocessing.Process(target=func, kwargs={"num": 3})  

## 6. 获取进程编号

1. 父进程：创建当前进程的进程，称为父进程；
2. 获取当前进程编号

	```python
	# 获取当前进程编号

	os.getpid()

	# 查看进程名

	multiprocessing.current_process().name
	```

3. 获取父进程编号

	```python
	os.getppid()
	```

## 7. 进程间不共享全局变量

1. 创建子进程会对主进程资源进行拷贝

2. 进程join：把进程原来的并行执行改成串行

	```python
	import multiprocessing
	import time

	l = []

	def write_data():
	    for i in range(10):
	        l.append(i)
	    print(l)


	def read_data():
	    print(l)


	if __name__=="__main__":
	    print('主进程开始！')
	    p1 = multiprocessing.Process(target=write_data)
	    p2 = multiprocessing.Process(target=read_data)
	    p1.start()
	    # join 将原来的并行改为串行，即将p1执行完之后，再进行后续操作
	    p1.join()
	    # time.sleep(1)
	    p2.start()
	    p2.join()
	    print('主进程结束！')
	```

3. 主进程会等到所有子进程结束后再结束


## 8. 主进程和子进程的执行顺序

1. 为了保证子进程能正常运行，**主进程会等到所有子进程执行结束后再销毁**

2. 如果想要主进程执行结束后结束子进程，可以通过**守护进程**或者**手动销毁子进程**

	```python
	# 设置守护主进程的方式：

	子进程对象.daemon = True

	# 销毁子进程的方式

	子进程对象.terminate()

	```


# 三、线程

# 四、锁 