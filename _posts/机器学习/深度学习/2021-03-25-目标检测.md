---
layout:     post                    # 使用的布局（不需要改）
title:      图像检测		    # 标题 
subtitle:   RCNN、Fast-RCNN、YOLO、SSD   	# 副标题
date:       2021-03-25              # 时间
author:     新宇                     # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               # 标签
    - 深度学习
---
# 一、目标检测
目标检测（Object Detection）的任务是找出图像中所有感兴趣的目标，并确定它们的类别和位置。
![](https://tva1.sinaimg.cn/large/008eGmZEly1gowa0vxnkcj30la08ttg5.jpg)
## 1. 位置信息的表现形式
- 目标检测的位置信息一般由两种格式（以图片左上角为原点(0,0)）：
	- 1、极坐标表示：(xmin, ymin, xmax, ymax)
		- xmin,ymin:x,y坐标的最小值
		- xmin,ymin:x,y坐标的最大值
	- 2、中心点坐标：(x_center, y_center, w, h)
		- x_center, y_center:目标检测框的中心点坐标
		- w,h:目标检测框的宽、高
![](https://tva1.sinaimg.cn/large/008eGmZEly1gowa25v6qlj30lj0n8k9w.jpg)

## 2. 常用的开源数据集
### 2.1 PASCAL VOC数据集
- PASCAL VOC是目标检测领域的经典数据集。
- PASCAL VOC包含约10,000张带有边界框的图片用于训练和验证。
- PASCAL VOC数据集是目标检测问题的一个基准数据集，很多模型都是在此数据集上得到的，
- 常用的是VOC2007和VOC2012两个版本数据，共20个类别，分别是：
	- 1.人: 人
	- 2.动物: 鸟，猫，牛，狗，马，羊
	- 3.交通工具: 飞机，自行车，船，公共汽车，汽车，摩托车，火车
	- 4.室内: 瓶子，椅子，餐桌，盆栽，沙发，电视/显示器
- 下载地址：https://pjreddie.com/projects/pascal-voc-dataset-mirror/
- 目录结构：
	- ![](https://tva1.sinaimg.cn/large/008eGmZEly1gowa5uc9n3j30fk053gmb.jpg)
	- JPEGImages存放图片文件、
	- Annotations下存放的是xml文件,描述了图片信息
	- ImageSets包含以下4个文件夹：
		- Action下存放的是人的动作（例如running、jumping等等）
		- Layout下存放的是具有人体部位的数据（人的head、hand、feet等等）
		- Segmentation下存放的是可用于分割的数据。
		- Main下存放的是图像物体识别的数据，总共分为20类，这是进行目标检测的重点。该文件夹中的数据对负样本文件进行了描述。


### 2.2 MS COCO数据集
MS COCO的全称是Microsoft Common Objects in Context，微软于2014年出资标注的Microsoft COCO数据集，与ImageNet竞赛一样，被视为是计算机视觉领域最受关注和最权威的比赛之一。

COCO数据集是一个大型的、丰富的物体检测，分割和字幕数据集。这个数据集以场景理解为目标，主要从复杂的日常场景中截取，图像中的目标通过精确的分割进行位置的标定。图像包括91类目标，328,000影像和2,500,000个label。目前为止目标检测的最大数据集，提供的类别有80 类，有超过33 万张图片，其中20 万张有标注，整个数据集中个体的数目超过150 万个。

![](https://tva1.sinaimg.cn/large/008eGmZEly1gowa7t7598j30lz0blnbi.jpg)
![](https://tva1.sinaimg.cn/large/008eGmZEly1gowa8hkcthj30lt069q4e.jpg)

## 3. 常用的评价指标



### 3.1 IOU
在目标检测算法中，IoU（intersection over union，交并比）是目标检测算法中用来评价2个矩形框之间相似度的指标：
**IoU = 两个矩形框相交的面积 / 两个矩形框相并的面积**

![](https://tva1.sinaimg.cn/large/008eGmZEly1gowa9myjt2j30ld086q38.jpg)

```python
import numpy as np

# 定义方法计算IOU

def Iou(box1, box2, wh=False):
    # 判断bbox的表示形式

    if wh == False:
        # 使用极坐标形式表示：直接获取两个bbox的坐标

        xmin1, ymin1, xmax1, ymax1 = box1
        xmin2, ymin2, xmax2, ymax2 = box2
    else:
        # 使用中心点形式表示： 获取两个两个bbox的极坐标表示形式

        # 第一个框左上角坐标

        xmin1, ymin1 = int(box1[0]-box1[2]/2.0), int(box1[1]-box1[3]/2.0)
        # 第一个框右下角坐标

        xmax1, ymax1 = int(box1[0]+box1[2]/2.0), int(box1[1]+box1[3]/2.0)
        # 第二个框左上角坐标

        xmin2, ymin2 = int(box2[0]-box2[2]/2.0), int(box2[1]-box2[3]/2.0)
        # 第二个框右下角坐标

        xmax2, ymax2 = int(box2[0]+box2[2]/2.0), int(box2[1]+box2[3]/2.0)
    # 获取矩形框交集对应的左上角和右下角的坐标（intersection）

    xx1 = np.max([xmin1, xmin2])
    yy1 = np.max([ymin1, ymin2])
    xx2 = np.min([xmax1, xmax2])
    yy2 = np.min([ymax1, ymax2])
    # 计算两个矩形框面积

    area1 = (xmax1-xmin1) * (ymax1-ymin1) 
    area2 = (xmax2-xmin2) * (ymax2-ymin2)
    #计算交集面积

    inter_area = (np.max([0, xx2-xx1])) * (np.max([0, yy2-yy1]))
    #计算交并比

    iou = inter_area / (area1+area2-inter_area+1e-6)
    return iou
```

假设我们检测结果如下所示，并展示在图像上：

```python
import matplotlib.pyplot as plt
import matplotlib.patches as patches

# 真实框与预测框

True_bbox, predict_bbox = [100, 35, 398, 400], [40, 150, 355, 398]
# bbox是bounding box的缩写

img = plt.imread('dog.jpeg')
fig = plt.imshow(img)
# 将边界框(左上x, 左上y, 右下x, 右下y)格式转换成matplotlib格式：((左上x, 左上y), 宽, 高)
# 真实框绘制

fig.axes.add_patch(plt.Rectangle(
    xy=(True_bbox[0], True_bbox[1]), width=True_bbox[2]-True_bbox[0], height=True_bbox[3]-True_bbox[1],
    fill=False, edgecolor="blue", linewidth=2))
# 预测框绘制

fig.axes.add_patch(plt.Rectangle(
    xy=(predict_bbox[0], predict_bbox[1]), width=predict_bbox[2]-predict_bbox[0], height=predict_bbox[3]-predict_bbox[1],
    fill=False, edgecolor="red", linewidth=2))

# 计算IOU

Iou(True_bbox,predict_bbox)
```

![](https://tva1.sinaimg.cn/large/008eGmZEly1gowabt8psyj30ip0dqalo.jpg)

### 3.2 mAP（Mean Average Precision）
