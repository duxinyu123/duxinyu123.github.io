---
layout:     post                    # 使用的布局（不需要改）
title:      图像检测-中		    # 标题 
subtitle:   RCNN、Fast-RCNN、Faster-RCNN   	# 副标题
date:       2021-03-26              # 时间
author:     新宇                     # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               # 标签
    - 深度学习
---
# 一、overfeat模型
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhcks46fj30m70f2gud.jpg)

# 二、RCNN
## 1. 算法流程
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhfyyuswj30lf07bqb0.jpg)

- 候选区域生成：
	- 使用选择性搜索（Selective Search）的方法找出图片中可能存在目标的侯选区域
- CNN网络提取特征：
	- 选取预训练卷积神经网网络（AlexNet或VGG）用于进行特征提取。
- 目标分类：
	- 训练支持向量机（SVM）来辨别目标物体和背景，对每个类别，都要训练一个二元SVM。
- 目标定位：
	- 训练一个线性回归模型，为每个辨识到的物体生成更精确的边界框。

## 2. 候选区域生成

在**选择性搜索（SelectiveSearch，SS）中**，使用语义分割的方法，它将颜色、边界、纹理等信息作为合并条件，采用多尺度的综合方法，将图像在像素级上划分出一系列的区域，这些区域要远远少于传统的滑动窗口的穷举法产生的候选区域。
SelectiveSearch在一张图片上提取出来约2000个侯选区域，需要注意的是这些候选区域的长宽不固定。而使用CNN提取候选区域的特征向量，需要接受固定长度的输入，所以需要对候选区域做一些尺寸上的修改。



## 3. CNN网络提取特征
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhibla0rj30l605yjue.jpg)
采用预训练模型(AlexNet或VGG)在生成的候选区域上进行特征提取，将提取好的特征保存在磁盘中，用于后续步骤的分类和回归。

1.全连接层的输入数据的尺寸是固定的，因此在将候选区域送入CNN网络中时，需进行裁剪或变形为固定的尺寸，在进行特征提取。
2.预训练模型在ImageNet数据集上获得，最后的全连接层是1000，在这里我们需要将其改为N+1(N为目标类别的数目，例如VOC数据集中N=20，coco数据集中N=80，1是加一个背景)后，进行微调即可。
3.利用微调后的CNN网络，提取每一个候选区域的特征，获取一个4096维的特征，一幅图像就是2000x4096维特征存储到磁盘中。

## 4. 目标分类(SVM)
假设我们要检测猫狗两个类别，那我们需要训练猫和狗两个不同类别的SVM分类器，然后使用训练好的分类器对一幅图像中2000个候选区域的特征向量分别判断一次，这样得出[2000, 2]的得分矩阵，如下图所示：
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhj52avvj30m10eqn5e.jpg)
对于N个类别的检测任务，需要训练N（目标类别数目）个SVM分类器，对候选区域的特征向量（4096维）进行二分类，判断其是某一类别的目标，还是背景来完成目标分类。

## 5. 目标定位
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhjnh9znj30lm0l5qeo.jpg)

## 6. 算法总结
- 训练阶段多，训练耗时： 
	- 微调CNN网络+训练SVM+训练边框回归器。
- 预测速度慢: 
	- 使用GPU, VGG16模型处理一张图像需要47s。
- 占用磁盘空间大：
	- 5000张图像产生几百G的特征文件。
- 数据的形状变化：
	- 候选区域要经过缩放来固定大小，无法保证目标的不变形

# 三、Fast-RCNN
- 考虑到R-CNN存在的问题，2015年提出了一个改善模型:Fast R-CNN。 相比于R-CNN, Fast R-CNN主要在以下三个方面进行了改进：
	- 1、**提高训练和预测的速度**
		- R-CNN首先从测试图中提取2000个候选区域，然后将这2000个候选区域分别输入到预训练好的CNN中提取特征。由于候选区域有大量的重叠，这种提取特征的方法，就会重复的计算重叠区域的特征- 。在Fast-RCNN中，将整张图输入到CNN中提取特征，将候选区域映射到特征图上，这样就避免了对图像区域进行重复处理，提高效率减少时间。
	- 2、**不需要额外的空间保存CNN网络提取的特征向量**
		- RCNN中需要将提取到的特征保存下来，用于为每个类训练单独的SVM分类器和边框回归器。在Fast-RCNN中，将类别判断和边框回归统一使用CNN实现，不需要在额外的空间存储特征。
	- 3、**不在直接对候选区域进行缩放**
		- RCNN中需要对候选区域进行缩放送入CNN中进行特征提取，在Fast-RCNN中使用ROIpooling的方法进行尺寸的调整。

## 1. 算法流程
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhm7ph0dj30lp0inn5s.jpg)

### 1.1 候选区域生成
与RCNN中一样，不再赘述

### 1.2 CNN网络特征提取
与RCNN中一样，使用预训练模型进行特征提取

### 1.3 ROI Pooling
> 只对感兴趣的特征进行pooling
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhu2h743j30lf0iethb.jpg)

### 1.4 目标分类和回归
原网络的最后一个全连接层替换为两个同级层:K+1个类别的SoftMax分类层和边框的回归层
![](https://tva1.sinaimg.cn/large/008eGmZEly1goxhnh3zjzj30md0ildoh.jpg)

## 2. 模型训练

## 3. 模型预测

## 4. 模型总结


# 四、Faster-RCNN